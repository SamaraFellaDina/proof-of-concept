<%- include('./partials/head') %>
<main>
  <ol class="charts">
    <li>
      <h2>Users in the last year</h2>
      <p class="charts-description">Which users have used our site, based on their country</p>
      <canvas id="countryChart" class="chart" width="400" height=""></canvas>
    </li>
    <li>
      <h2>browser of users</h2>
      <canvas id="browserChart" class="chart" width="400" height=""></canvas>
    </li>
    <li>
      <h2>browser of users</h2>
      <canvas id="devicesChart" class="chart" width="400" height=""></canvas>
    </li>
  </ol>

</main>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>

  const colourTheme = [
    '#B9FFB7',
    '#FF7535',
    '#5E43FF'
  ];
  
  const borderColour = ['#302A2F;'];
  const borderWidth = 1.5;
  
  const country = document.getElementById('countryChart');
  function createCountryChart() {
    const countryData = <%- JSON.stringify(country.rows) %>;
    let otherValue = 0;
  
    const labels = [];
    const data = [];
  
    countryData.forEach(function(row) {
      const value = parseInt(row.metricValues[0].value);
      const label = row.dimensionValues[0].value;
  
      if (value < 13) {
        otherValue += value;
      } else {
        labels.push(label);
        data.push(value);
      }
    });
  
    if (otherValue > 0) {
      labels.push('Other');
      data.push(otherValue);
    }
  
    new Chart(country, {
      type: 'doughnut',
      data: {
        labels: labels,
        datasets: [{
          label: 'Aantal keer bezocht',
          data: data,
          backgroundColor: colourTheme,
          borderWidth: borderWidth,
          borderColor: borderColour
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
    });
  }
  createCountryChart();
  
  const browser = document.getElementById('browserChart');
  function createBrowserChart() {
    const browserData = <%- JSON.stringify(browser.rows) %>;
  
    let otherValue = 0;
  
    const labels = [];
    const data = [];
  
    browserData.forEach(function(row) {
      const value = parseInt(row.metricValues[0].value);
      const label = row.dimensionValues[0].value;
    
      if (value < 15) {
        otherValue += value;
      } else {
        labels.push(label);
        data.push(value);
      }
    });
  
    if (otherValue > 0) {
      labels.push('Other');
      data.push(otherValue);
    }
  
    new Chart(browser, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Aantal keer bezocht',
          data: data,
          backgroundColor: colourTheme,
          borderWidth: borderWidth,
          borderColor: borderColour
    
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
       }
     }
   });
  }
  createBrowserChart();
  
  const devices = document.getElementById('devicesChart');
  function createdevicesChart() {
    const devicesData = <%- JSON.stringify(devices.rows) %>;
  
    let otherValue = 0;
    
    const labels = [];
    const data = [];
  
    devicesData.forEach(function(row) {
      const value = parseInt(row.metricValues[0].value);
      const label = row.dimensionValues[0].value;
    
      if (value < 15) {
        otherValue += value;
      } else {
        labels.push(label);
        data.push(value);
      }
    });
    
    if (otherValue > 0) {
      labels.push('Other');
      data.push(otherValue);
    }
  
    new Chart(devices, {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Aantal keer bezocht',
          data: data,
          backgroundColor: colourTheme,
          borderWidth: borderWidth,
          borderColor: borderColour
        }]
      },
      options: {
        scales: {
          y: {
            beginAtZero: true
          }
        }
      }
   });
  }
  createdevicesChart();

</script>


<!-- <ul>
  <% devices.rows.forEach(function(row) { %>
    <li><%= row.dimensionValues[0].value %>: <%= row.metricValues[0].value %></li>
  <% }) %>
</ul> -->
